# linux定时任务`crontab`命令

## 简介

`crond`是在`linux`用于控制计划任务，这个服务一般是默认启动的。`linux`为了方便用户自己管理计划任务，所以提供了`crontab`这个前端命令。

## 常用命令格式

* `crontab [-u user] file`

执行一个计划任务配置文件

* `crontab [-u user] [-l | -r | -e] [-i] [-s]`

对（某用户的）计划任务查看（`-l`）、删除（`-r，-i`）、编辑（`-e，-s`）

更详细的使用方法参见`man`文档。

```shell
man crontab
```



## `crontab`文件格式

下面是一个`crontab`文件例子：

```shell
SHELL=/bin/bash
PATH=/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=root
HOME=/tmp

1 * * * * /tmp/test.sh
```

文件的第一部分是环境变量的设置，其中包括一个`MAILTO`变量，表示crond的任务执行信息将通过电子邮件发送给`root`用户，如果MAILTO变量的值为空，则表示不发送任务 执行信息给用户。HOME变量指定了在执行命令或者脚本时使用的主目录.

接下来就表示任务的配置了。

| **列**   | 1          | 2            | 3            | 4            | 5                          | 6            |
| -------- | ---------- | ------------ | ------------ | ------------ | -------------------------- | ------------ |
| **解释** | 分钟(0-59) | 小时（0-23） | 日期（1-31） | 月份（1-12） | 星期（0-7,0和7都代表周日） | 要执行的命令 |

在以上各个字段中，还可以使用以下特殊字符：

星号（*）：代表所有可能的值，例如month字段如果是星号，则表示在满足其它字段的制约条件后每月都执行该命令操作。

逗号（,）：可以用逗号隔开的值指定一个列表范围，例如，“1,2,5,7,8,9”

中杠（-）：可以用整数之间的中杠表示一个整数范围，例如“2-6”表示“2,3,4,5,6”

正斜线（/）：可以用正斜线指定时间的间隔频率，例如“0-23/2”表示每两小时执行一次。同时正斜线可以和星号一起使用，例如*/10，如果用在minute字段，表示每十分钟执行一次。

## 示例

### 查看计划任务

使用`-l`参数可以查看当前用户的计划任务，或者配合`-u`参数查看其他用户的计划任务。（需要`root`权限）

```shell
crontab -l -u skyfire
```

### 创建定时任务

创建一个文件`test_crontab`,内容如下：

```shell
SHELL=/bin/bash
PATH=/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=root
HOME=/tmp

*/1 * * * * date > date.txt

```

表示每1分钟执行一次将当前日期时间输出到`date.txt`

在`test_crontab`所在目录下执行命令（配合`-u`参数可以为其他用户增加计划任务）：

```shell
crontab test_crontab
```

查看计划任务：

```shell
crontab -l
```

此时应该可以看到我们在`test_crontab`中编辑的内容。

可以通过检测`/tmp/date.txt`检测定时任务是否正常运行。（此文件应该每1分钟更新一次当前时间）

### 编辑计划任务

可以使用`crontab -e`编辑计划任务（配合`-u`参数可以修改其他用户的计划任务）：

```shell
crontab -e
```

此命令会打开默认编辑器编辑`crontab`文件。

编辑完成后可以用`crontab -l`查看修改后的计划任务，并验证是否正确执行。

### 删除计划任务

使用`-r`参数可以删除计划任务，加上`-i`参数会在删除前询问（配合`-u`参数可以删除其他用户的计划任务）。

```shell
crontab -r -i
```

删除后再使用`crontab -l`可以查看删除结果。
